zephyr_include_directories(.)

function(custom_library library_name sources)
  zephyr_library_named(${library_name})
  zephyr_library_sources(${sources} ${ARGN})
  # Depend on the public Zephyr interface
  target_link_libraries(${library_name} PRIVATE zephyr_interface)
  # That's some magic to build autogenerated headers.
  # See https://lists.zephyrproject.org/g/devel/message/5475.
  add_dependencies(${library_name} offsets_h)
endfunction()

if(CONFIG_SPI)
  custom_library(cc1101 cc1101.cpp)
endif()

custom_library(color color.cpp)

custom_library(timer timer.cpp)
target_link_libraries(timer PRIVATE kernel)

if(CONFIG_ADC)
  custom_library(battery battery.cpp)
endif()

if(CONFIG_BT)
  custom_library(bluetooth bluetooth.cpp)
endif()

custom_library(buzzer buzzer.cpp)
target_link_libraries(buzzer PRIVATE timer)

custom_library(rgb_led rgb_led.cpp)
target_link_libraries(rgb_led PRIVATE color timer)

if(CONFIG_TEST)
  custom_library(printk_event_handler printk_event_handler.cpp)
  target_link_libraries(printk_event_handler PRIVATE pw_unit_test.googletest_style_event_handler)
endif()